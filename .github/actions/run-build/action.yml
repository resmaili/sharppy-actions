name: Run Build
defaults:
  run:
    shell: bash -l {0}

inputs:
  python-version:
    required: true
  path:
    required: true

runs:
  using: composite
  steps:
    - name: Get Date
      id: get-date
      run: |
        echo "::set-output name=date::$(/bin/date -u "+%Y%m%d")"
      shell: bash

    - name: Load cache
      # description: Look for os-specific cached environment
      uses: actions/cache@v3
      with:
        path: ${{ inputs.path }}
        key: conda-${{ runner.os }}-${{ inputs.python-version}}-${{ hashFiles('environment.yml') }}-${{ steps.get-date.outputs.date }}

    - name: build ${{ runner.os}} x ${{ inputs.python-version}}
      if: startsWith(runner.os, 'macOS')
      shell: bash -l {0}
      run: |
        conda activate devel
        cd runsharp
        pyinstaller SHARPpy-osx.spec --log-level DEBUG
