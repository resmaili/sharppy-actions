name: Run Build
defaults:
  run:
    shell: bash -l {0}

inputs:
  python-version:
    required: true


runs:
  using: composite
  steps:
    # - name: Load cache
    #   description: Look for os-specific cached environment
    #   uses: actions/cache@v3
    #   with:
    #     path: ${{ env.pythonLocation }}
    #     key: conda-${{ runner.os }}-${{ inputs.python-version}}-${{ hashFiles('environment.yml') }}

    - name: build ${{ runner.os}} x ${{ inputs.python-version}}
      if: startsWith(runner.os, 'win')
      shell: bash -l {0}
      run: |
        conda activate devel
        python ci/screen.py
        python -c "import ssl; print(ssl.__file__)"

        pip install -e .
        pytest -v --junitxml=junit/test-results.xml

        cd runsharp
        pyinstaller SHARPpy-win7-64.spec --log-level DEBUG
